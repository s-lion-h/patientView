<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

    <script src="https://cdn.bootcss.com/echarts/4.4.0-rc.1/echarts.js"></script>
</head>
<body>
<!--<div class="container-fluid">-->
<div class="container">
<!--    <h2 th:text="${msg}"></h2>-->
    <h1 class="text-center" th:text="${hisPatientInfo.name}"></h1>
    <div class="row">
        <div class="col">
            <p th:text="'年龄：'+${year}"></p>
            <p th:text="${hisPatientInfo.homeNow}!=null?'地址：'+${hisPatientInfo.homeNow}:'地址：'+${patientInfo.address}"></p>
            <p th:text="${hisPatientInfo.idenno}!=null?'证件号：'+${hisPatientInfo.idenno}:'证件号：'+${patientInfo.idno}"></p>
            <p th:text="${clientManager.employeeName}==null?'专属客服：无专属客服':'专属客服：'+${clientManager.employeeName}"></p>
            <p class="text-info" th:text="'预产期：'+${#dates.format(patientInfo.expectedtime, 'yyyy年MM月dd日')}"></p>
            <p th:text="${hisPatientInfo.homeTel}!=null?'电话：'+${hisPatientInfo.homeTel}:'电话：'+${patientInfo.phone}"></p>
        </div>
        <div class="col">
            <hr>
            <div class="text-center">
                <h2><span class="badge badge-dark" th:if="${coupon.patientlevel}!=null" th:text="${CRM_PATIENTLEVEL.get('__${coupon.patientlevel}__').dictionaryName}"></span></h2>
<!--                <h2><span class="badge badge-dark" th:text="${coupon.patientlevel}"></span></h2>-->
            </div>
            <div class="text-center">
                <code th:text="'总消费：'+${coupon.couponaccumulate}"></code>
                <br>
                <code th:text="'积分：'+${coupon.couponvacancy}"></code>
            </div>
        </div>
        <div class="col">
            <h3>客户标签</h3>
            <div class="row"><!--标签-->
                <button type="button" class="btn btn-danger btn-block text-left" th:text="'身体：'+${patientlabel.get('LABELTYPE1')}"></button>
                <button type="button" class="btn btn-info btn-block text-left" th:text="'背景：'+${patientlabel.get('LABELTYPE2')}"></button>
                <button type="button" class="btn btn-warning btn-block text-left" th:text="'性格：'+${patientlabel.get('LABELTYPE3')}"></button>
                <button type="button" class="btn btn-success btn-block text-left" th:text="'兴趣 ：'+${patientlabel.get('LABELTYPE4')}"></button>
            </div>

        </div>
    </div>
    <hr>
    <div class="row">
<!--        预约的做两个，第一个是就诊预约，第二个是项目预约-->
        <th:block th:if="${latestAppointment.appointtype}==1">
            <div class="col-7">
                <div class="col">
                    <h3>最新预约——就诊</h3>
                    <hr>
                    <p th:text="'预约医生：'+${latestAppointment.doctname}">一级病种：医学美容</p>
                    <p th:text="'预约科室：'+${latestAppointment.deptname}">预约科室：医学美容门诊</p>
<!--                    <p th:text="'登记日期：'+${latestAppointment.createtime}"></p>-->
                    <p th:text="'预约日期：'+${#dates.format(latestAppointment.appointdate, 'yyyy年MM月dd日')}"></p>
                    <p th:text="'预约时间：'+${#dates.format(latestAppointment.begintime, 'HH:mm')}+'---'+ ${#dates.format(latestAppointment.endtime, 'HH:mm')}"></p>
                    <p th:text="'记录人：'+${latestAppointment.createopername}"></p>
                </div>
            </div>
        </th:block>
        <th:block th:if="${latestAppointment.appointtype}==2">
            <div class="col-7">
                <div class="col">
                    <h3>最新预约——项目</h3>
                    <hr>
                    <p th:text="'预约子项目：'+${latestAppointment.appointchilditem}"></p>
<!--                    <p th:text="'登记日期：'+${latestAppointment.createtime}"></p>-->
                    <p th:text="'预约子项目名称：'+${latestAppointment.appointitemname}"></p>
<!--                    <p>预约科室：医学美容门诊</p>-->
                    <p th:text="'预约日期：'+${#dates.format(latestAppointment.appointdate, 'yyyy年MM月dd日')}"></p>
                    <p th:text="'预约时间：'+${#dates.format(latestAppointment.begintime, 'HH:mm')}+'---'+ ${#dates.format(latestAppointment.endtime, 'HH:mm')}"></p>
                    <!--                    <p>备注：共振+无针水光（还没购买）</p>-->
                    <p th:text="'记录人：'+${latestAppointment.createopername}"></p>

                </div>
            </div>
        </th:block>
        <th:block th:if="${latestAppointment.appointtype}==3">
            <div class="col-7">
                <div class="col">
                    <h3>最新预约——活动</h3>
                    <hr>
                    <p th:text="'活动：'+${latestAppointment.appointmarketing}"></p>
<!--                    <p th:text="'登记日期：'+${latestAppointment.createtime}"></p>-->
                    <p th:text="'预约日期：'+${#dates.format(latestAppointment.appointdate, 'yyyy年MM月dd日')}"></p>
                    <p th:text="'预约时间：'+${#dates.format(latestAppointment.begintime, 'HH:mm')}+'---'+ ${#dates.format(latestAppointment.endtime, 'HH:mm')}"></p>
                    <p th:text="'记录人：'+${latestAppointment.createopername}"></p>

                </div>
            </div>
        </th:block>
        <div class="col-5">
            <!-- 为 ECharts 准备一个具备大小（宽高）的 DOM -->
            <div id="main" style="width: auto;height:400px;"></div>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <h3>套餐情况</h3>
            <hr>
<!--            <p>产检套餐：盆底肌治疗第一疗程(7800元)</p>-->
<!--            <p>产检套餐：分娩套餐</p>-->
<!--            <p>月子套餐：新无忧版42天母亲复查套餐(2019)</p>-->
<!--            <p>月子套餐：7天月子豪华标准型30平[基础包]</p>-->
<!--            <p>医美套餐：王牌严选-(育龄抗衰5980元)</p>-->
<!--            <p>医美套餐：王牌严选</p>-->
            <p th:each="package:${packageList}" th:text="${package.packageName+'——'+#dates.format(package.delimitingDate, 'yyyy年MM月dd日')}"></p>
        </div>
        <div class="col">
            <h3>诊疗记录</h3>
<!--            <ul class="list-group">-->
<!--                <li class="list-group-item">门诊：产科门诊——侯红英</li>-->
<!--                <li class="list-group-item">住院：住院——侯红英</li>-->
<!--                <li class="list-group-item">门诊：产科门诊——侯红英</li>-->
<!--                <li class="list-group-item">住院：住院——侯红英</li>-->
<!--                <li class="list-group-item">月子：产科月子——侯红英</li>-->
<!--                <li class="list-group-item">月子：产科月子——侯红英</li>-->
<!--            </ul>-->
            <ul>
                <li th:each="register:${registerList}" th:text="${register.deptName+'---'+register.doctName+'---'+register.reglevlName}"></li>
            </ul>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <div id="timeline" style="width: auto;height:250px;"></div>

        </div>
    </div>
    <hr>
    <div class="row">
        <div class="col">
            <h2>最近回访</h2>
            <table class="table">
                <thead>
                <tr>
                    <th scope="col">内容</th>
                    <th scope="col">回访部门</th>
                    <th scope="col">计划回访时间</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="revisit:${revisitList}">
                    <th scope="row" th:text="${visitTypeMap.get('__${revisit.visitType}__').dictionaryName}"></th>
<!--                    <th scope="row" th:text="${revisit.visitType}">宝宝亲子潜伏</th>-->
                    <td th:if="${revisit.visitDept}!=null" th:text="未知科室"></td>
                    <td th:if="${revisit.visitDept}==null" th:text="${revisit.visitDept}"></td>
                    <td th:text="${#dates.format(revisit.visitTime, 'yyyy年MM月dd日')}"></td>
                </tr>
                </tbody>
            </table>
        </div>
        <div class="col">
            <h2>最近消费</h2>
            <table class="table">
                <thead>
                <tr>
                    <th scope="col">消费项目</th>
                    <th scope="col">日期</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="feeDetail:${feeDetailList}">
                    <td th:text="${feeDetail.itemName}"></td>
                    <td th:text="${#dates.format(feeDetail.feeDate, 'yyyy年MM月dd日')}"></td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
</body>
<script type="text/javascript">
    // 基于准备好的dom，初始化echarts实例
    var myChart = echarts.init(document.getElementById('main'));

    // 指定图表的配置项和数据
    var option = {
        title: {
            text: '一年消费金额'
        },
        tooltip: {},
        legend: {
            data:['数量']
        },
        xAxis: {
            data: ["产检","医美","儿保","分娩"]
        },
        yAxis: {},
        series: [{
            name: '数量',
            type: 'bar',
            data: [5, 20, 31, 10]
        }]
    };

    // 使用刚指定的配置项和数据显示图表。
    myChart.setOption(option);
</script>
<script type="text/javascript" th:inline="javascript">
    function getVirtulData(year) {
        year = year || '2019';
        var date = +echarts.number.parseDate(year + '-01-01');
        var end = +echarts.number.parseDate((+year + 1) + '-01-01');
        var dayTime = 3600 * 24 * 1000;
        var data = [];
        for (var time = date; time < end; time += dayTime) {
            data.push([
                echarts.format.formatTime('yyyy-MM-dd', time),
                Math.floor(Math.random() * 10000)
            ]);
        }
        return data;
    }

    var dates = [];
    for (i=0; i < [[${arriveDates}]].length;i++){
        var str=[[${arriveDates}]][i];
        dates.push([
            str,
            10000
        ]);
    }

    // 基于准备好的dom，初始化echarts实例
    var myChartTimeline = echarts.init(document.getElementById('timeline'));

    // 指定图表的配置项和数据
    var optionTimeline = {
        title: {
            top: 30,
            left: 'center',
            text: '2019年到诊情况'
        },
        tooltip : {},
        visualMap: {
            min: 0,
            max: 10000,
            type: 'piecewise',
            orient: 'horizontal',
            left: 'center',
            top: 65,
            textStyle: {
                color: '#000'
            }
        },
        calendar: {
            top: 120,
            left: 30,
            right: 30,
            cellSize: ['auto', 13],
            range: '2019',
            itemStyle: {
                normal: {borderWidth: 0.5}
            },
            yearLabel: {show: false}
        },
        series: {
            type: 'heatmap',
            coordinateSystem: 'calendar',
            // data: getVirtulData(2019)
            data:dates
        }
    };

    // 使用刚指定的配置项和数据显示图表。
    myChartTimeline.setOption(optionTimeline);
</script>
<!--[['2019-02-11', 10000], ['2019-01-21', 10000], ['2019-07- 01', 10000], ['2019-08-26', 10000],-->
<!--['2018-11-25', 10000],['2019-03-11', 10000]['2019-07-31', 10000],-->
<!--['2019-10-12', 10000],['2019-07-08', 10000],['2018-12-29', 10000],-->
<!--['2019-05-13', 10000], ['2019-06-24', 10000], ['2019-04-08', 10000], ['2019-06-02', 10000],-->
<!--['2019-06-10', 10000],['2019-11-12', 10000]['2019-11-17', 10000],-->
<!--['2019-02-20', 10000],['2019-04-29', 10000],['2019-05-27', 10000]]-->
</html>